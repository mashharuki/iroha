// キーペア作成処理(*実行時にsudoが必要)
let DOMAIN  = process.argv[2]   // ドメイン名
let ACCOUNT = process.argv[3]   // アカウント名

let public_key = ''             // 開鍵を格納(初期化)
let private_key = ''            // 秘密鍵を格納(初期化)

let fs = require('fs')          // ファイルモジュールを読込

const KEY_DIR = '/home/haruki/git/iroha/example/' // キーペアのディレクトリ(実行環境に依存)

let ed25519 = require('ed25519.js')       // ed25519オブジェクト作成
let keys = ed25519.createKeyPair()        // キーペア作成
let pub = keys.publicKey                  // public key セット
let priv = keys.privateKey                // private key セット

for (var i = 0; i < 32; i++) {            // 配列を文字列に変換
  public_key = public_key + pub[i].toString(16).padStart(2, '0')
}

for (var i = 0; i < 32; i++) {            // 配列を文字列に変換
  private_key = private_key + priv[i].toString(16).padStart(2, '0')
}

console.log('public Key :', public_key)   // public key をコンソールに出力
console.log('private Key:', private_key)  // private key をコンソールに出力

//公開鍵をファイルに書き出し
fs.writeFile(KEY_DIR + ACCOUNT + '@' + DOMAIN + '.pub', public_key , function (err) {
  if (err) {
     throw err
  }
})

//秘密鍵をファイルに書き出し
fs.writeFile(KEY_DIR + ACCOUNT + '@' + DOMAIN + '.priv', private_key , function (err) {
  if (err) {
     throw err
  }
})
